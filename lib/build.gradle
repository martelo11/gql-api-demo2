/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java library project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.8/userguide/building_java_projects.html
 */
 
plugins {
	// Apply shadow plugin to create a fat jar
	// https://imperceptiblethoughts.com/shadow/
 	id 'com.github.johnrengelman.shadow' version '7.1.2'
    id 'java'
}

description = 'GraphQL API Demo for Server-Side Technology Stack: Java, GraphQL-Java, SPQR, Bootique, Jetty'

//eclipse {
//    classpath {
//       downloadSources=true
//    }
//}
sourceSets {
    main.java.srcDir "src/main/java"
    main.resources.srcDir "src/main/resources"
}

// Fix 'fake duplicates' issue
// https://github.com/gradle/gradle/issues/17236
tasks.withType(Copy).all {
    duplicatesStrategy 'exclude'
}
  
tasks.jar {
    manifest.attributes["Main-Class"] = "de.example.api.Application"
}

// Output to build/libs/shadow.jar
shadowJar {
   archiveBaseName.set('shadow')
   archiveClassifier.set('all')
   archiveVersion.set('1.0')
   // TODO include 'lib/demo.yml'
}

repositories {
    // Use JCenter for resolving dependencies.
    jcenter()
    mavenCentral()
    mavenLocal()
}

dependencies {
    // Use JUnit test framework.
    testImplementation "junit:junit:4.13.x"
    testImplementation "io.bootique:bootique-test:$BootiqueVersion"
    testImplementation "io.bootique.jetty:bootique-jetty-junit5:$BootiqueVersion"

    // Immutables annotation processor
    annotationProcessor "org.immutables:value:$ImmutablesVersion"
    // Immutables are not included during runtime
    compileOnly "org.immutables:value:$ImmutablesVersion"
    compileOnly "org.immutables:annotate:$ImmutablesVersion"
    compileOnly "org.immutables:builder:$ImmutablesVersion"
    
 	// Bootique (SpringBoot alternative)
 	// https://bootique.io/
    // https://bootique.io/docs/2.x/getting-started/
    implementation platform("io.bootique.bom:bootique-bom:$BootiqueVersion")

    implementation (
    	// Google Gaava
    	"com.google.guava:guava:29.0-jre",
    	
     	// Bootique Jersey (Integrates JAX-RS server as a servlet)
        "io.bootique.jersey:bootique-jersey:$BootiqueVersion",
        "io.bootique.logback:bootique-logback:$BootiqueVersion",
        // TODO Metrics and Healthchecks
        // "io.bootique.jetty:bootique-jetty-instrumented"
        // TODO Support for CORS
        // configure rules in YAML under "jettycors" root element (see details https://bootique.io/docs/2.x/bootique-jetty-docs/#jettycors).
        // "io.bootique.jetty:bootique-jetty-cors"

    	// Fix (MessageBodyWriter not found exception)
    	"org.glassfish.jersey.media:jersey-media-json-jackson:2.35",
        
    	// SPQR
    	"io.leangen.graphql:spqr:$SPQRVersion",
    
    	// Java Faker (Random Data Generator)
    	"com.github.javafaker:javafaker:$JavaFakerVersion"
    )
    
    // add resource path to classpath (to make WEB-INF available)
    // lib\build\resources\main\WEB-INF\graphiql
    // lib/bin/main/WEB-INF\graphiql
    // implementation files('lib/bin/main')
    implementation files('bin/main')
}
